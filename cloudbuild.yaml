options:
  logging: CLOUD_LOGGING_ONLY
steps:
  #build
  - name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', 'gcr.io/inspired-memory-449608-f9/shop-copilot:latest', '.']
  #push
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', 'gcr.io/inspired-memory-449608-f9/shop-copilot:latest']
  #deploy to cloud run
  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
    entrypoint: gcloud
    args: ['run','deploy','shop-copilot','--image','gcr.io/inspired-memory-449608-f9/shop-copilot:latest','--region','us-central1','--platform','managed','--allow-unauthenticated', '--update-secrets','OPENAI_API_KEY=openai-api-key:latest,REPLICATE_API_TOKEN=replicate-api-key:latest']
  
  # authenticate to GKE
#   - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
#     entrypoint: 'bash'
#     args:
#       - '-c'
#       - |
#         gcloud container clusters get-credentials shop-cluster --zone us-central1 --project inspired-memory-449608-f9

#     # deploy kube config files to google kubernetes engine (GKE)
#   - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
#     entrypoint: 'bash'
#     args: 
#       - '-c'
#       - |
#         kubectl apply -f kubernetes/deployment.yaml
#         kubectl apply -f kubernetes/service.yaml

# images:
  - 'gcr.io/inspired-memory-449608-f9/shop-copilot:latest'